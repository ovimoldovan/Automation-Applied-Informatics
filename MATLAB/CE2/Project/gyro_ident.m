%% sample data
A = [1082		-3.17	34.61
1185		1.62	38.81
1289		3.49	35.91
1393		0.26	-29.38
1498		-13.26	-47.34
1601		-21.18	-49.45
1705		-18.38	34.61
1810		-0.55	52.24
1913		8.32	57.14
2018		14.24	53.87
2121		17.57	-29.10
2226		2.01	-54.39
2330		-11.13	-56.59
2434		-24.97	-54.39
2538		-29.48	29.38
2642		-16.12	54.98
2746		-3.36	59.34
2850		11.91	59.83
2954		25.19	58.77
3058		27.89	-22.85
3163		21.58	-48.97
3266		18.81	-48.97
3371		12.08	-48.97
3475		7.83	-52.24
3578		3.52	-53.87
3683		-5.60	-53.87
3786		-12.54	-55.50
3891		-18.68	29.67
3995		-9.41	56.59
4099		-1.94	59.34
4203		4.82	60.40
4307		8.48	54.98
4411		10.29	-28.02
4515		-0.41	-50.12
4619		-11.18	-54.39
4723		-22.72	34.28
4828		-6.40	57.14
4931		3.30	60.40
5036		11.02	57.14
5139		17.08	-26.37
5243		10.98	-50.61
5348		8.13	-50.61
5451		1.88	-52.24
5556		-5.59	-55.50
5659		-12.45	-54.98
5764		-22.90	29.67
5868		-17.93	57.14
5971		-10.60	58.21
6076		-3.90	62.64
6180		5.75	61.44
6284		15.66	59.34
6388		24.05	-22.64
6492		22.66	-42.44
6596		19.57	-45.71
6701		18.59	-50.61
6804		17.29	-49.45
6908		19.44	-48.97
7013		17.17	-50.61
7116		11.71	-50.61
7221		6.85	-52.24
7324		1.07	-53.36
7429		-6.50	-54.39
7533		-17.94	-54.98
7636		-30.89	32.97
7741		-21.35	55.50
7844		-16.28	58.21
7949		-10.82	59.34
8053		-2.43	59.83
8157		4.47	57.69
8261		7.77	58.77
8366		12.32	-27.75
8469		2.21	-52.75
8573		-0.63	-53.36
8677		-7.25	-53.87
8781		-12.68	31.02
8886		3.05	58.77
8989		16.23	58.77
9094		22.69	-23.08
9198		13.24	-45.27
9302		4.27	-51.10
9406		-0.40	-52.24
9509		-8.49	-52.24
9614		-20.23	32.97
9718		-14.38	58.21
9822		-7.05	59.34
9926		-0.29	59.83
10030		6.24	59.34
10134		8.38	62.64
10238		12.55	-25.87
10342		3.02	-49.45
10446		-2.67	-53.36
10551		-7.24	-57.14
10654		-11.12	26.12
10759		-6.33	52.24
10863		-2.23	58.21
10967		5.00	60.99
11071		13.34	58.77
11174		20.10	-25.87
11279		13.85	-46.15
11383		8.70	-48.51
11487		3.78	-48.97
11591		-3.76	-52.24
11696		-15.56	-55.50
11799		-28.64	29.10
11904		-19.37	57.69
12008		-12.12	60.40
12111		-5.20	58.21
12216		7.60	60.99
12320		19.37	58.21
12424		25.63	-21.43
12528		17.23	-44.08
12633		11.52	-50.61
12736		6.19	-52.75
12840		-0.35	-51.74
12945		-8.36	-53.87
13048		-15.65	29.38
13153		-9.22	58.77
13257		-2.48	58.21
13361		7.26	59.34
13465		15.11	59.83
13569		20.91	-24.49
13673		16.13	-46.15
13777		13.57	-46.89
13881		10.65	-51.10
13985		2.85	-52.24
14090		-5.33	-53.87
14193		-12.48	-53.87
14298		-20.84	31.32
14402		-14.27	56.59
14505		-6.12	60.99
14610		5.32	62.03
14714		14.15	56.59
14818		17.07	-24.72
14922		9.49	-45.27
15026		5.06	-51.10
15130		0.34	-53.87
15235		-7.27	-53.87
15338		-14.12	-56.04
15442		-24.91	32.34
15547		-22.87	55.50
15650		-21.61	60.40
15755		-20.79	58.77
15858		-21.29	56.59


]
%% controller
n = length(A(:,1));
time = A(:,1);
angle = A(:,2);
input = A(:,3);

plot(time,angle);xlabel('time');ylabel('degrees');

dat = iddata(angle,input,0.1);

%plot(dat)

H = tfest(dat,3,1)
%compare(dat,H)

Hds = tf(1, [2 2]);
Hfinvers = tf([1 10.47 141.2 88.7], [10.83, 107.7]);
Hr = Hds * Hfinvers;




H = tf(H);
Ho = feedback(H,1);


%% machine learning try
% NET = cascadeforwardnet(20);

%Create a two-layer, feed-forward neural network and initialize the network input and output dimensions to 2 and 1, respectively. Use 5 neurons for first layer and 7 for second layer.
%NET = feedforwardnet([5 7]);

%net = feedforwardnet([5 8 2]);
%net.layers{1}.transferFcn = 'logsig';
%net.layers{2}.transferFcn = 'radbas';
%net.layers{3}.transferFcn = 'purelin';

%view(net)

%NET = cascadeforwardnet(20);
%N = neuralnet(NET);
%Model = nlarx(dat, [2 2 1], N);

%compare(dat, Model)

%io = linio(Model);
%linsys = linearize(Model,io);
%tf(linsys)



